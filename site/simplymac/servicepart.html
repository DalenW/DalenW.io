<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>SM Service Part</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
        <link type="text/css" rel="stylesheet" href="/styles/main.css">
        <link type="text/css" rel="stylesheet" href="operations.css">
    </head>

    <style>
        .textInput {
            width: 400px;
        }
        
        .checkbox {
            width: 50px;
        }

        #submitButton {
            width: 100px;
        }
    </style>

    <body>
        <header>
                <a href="/simplymac/"><h1>Service Part Recieving</h1></a>
        </header>
        <main>
            <form action="javascript:submit()" id="form">
                <p id="SROLabel">SRO Number: </p>
                <input type="text" name="SRO" id="SROInput" class="textInput">
                <p id="sentTrackingLabel">Sent Tracking Number: </p>
                <input type="text" name="sentTracking" id="sentTrackingInput" class="textInput">
                <p id="returnTrackingLabel">Return Tracking Number:  </p>
                <input type="text" name="returnTracking" id="returnTrackingInput" class="textInput">
                <br>
                <p>Sales Order in RQ? 
                <input type="checkbox" name="RQCheck" id="RQCheck" class="checkbox" checked> </p>
            </form>
            <br>
            <p id="outputText"></p>
        </main>
    </body>
    <script src="/scripts/jquery.js"></script>
    <script>
        var sro = "null";
        var sentTracking = "null";
        var returnTracking = "null";
        var RQCheck = true;
        var sentShipper = "Shipper";
        var returnShipper = "Shipper";

        var UPSLength = 18;
        var FedExLength = 34;

        //on page load clear form
        clear();

        $("#SROInput").change(function () {
            var value = $("#SROInput").val();
            if(value.length == "UT101082385".length) {
                $("#SROLabel").css("color", "var(--main-green)");
                sro = value;
            } else {
                $("#SROLabel").css("color", "var(--main-red)");
                sro = "null";
            }
            updateText();
        });

        $("#sentTrackingInput").change(function () {
            var value = $("#sentTrackingInput").val();
            if(value.length == UPSLength || value.length == FedExLength) {
                var shipType = value.slice(0,2);
                if(value.length == UPSLength && shipType == "1Z") {
                    $("#sentTrackingLabel").css("color", "var(--main-green)");
                    sentTracking = value;
                    sentShipper = "UPS";
                } else if(value.length == FedExLength && (shipType == "10" || shipType == "96")) {
                    var bar = value.slice(22, 26) + " " + value.slice(26, 30) + " " + value.slice(30);
                    $("#sentTrackingLabel").css("color", "var(--main-green)");
                    sentTracking = bar;
                    sentShipper = "FedEx";
                } else {
                    $("#returnTrackingLabel").css("color", "var(--main-red)");
                    sentTracking = "null";
                }
            } else if ($("#sentTrackingInput").val() == "") {
                $("#sentTrackingLabel").css("color", "var(--slategray)");
                sentTracking = "null";
            } else {
                $("#sentTrackingLabel").css("color", "var(--main-red)");
                sentTracking = "null";
            }
            updateText();
        });

        $("#returnTrackingInput").change(function () {
            var value = $("#returnTrackingInput").val();
            if(value.length == UPSLength || value.length == FedExLength) {
                var shipType = value.slice(0,2);
                if(value.length == UPSLength && shipType == "1Z") {
                    $("#returnTrackingLabel").css("color", "var(--main-green)");
                    returnTracking = value;
                    returnShipper = "UPS";
                } else if(value.length == FedExLength && (shipType == "10" || shipType == "96")) {
                    var bar = value.slice(22, 26) + " " + value.slice(26, 30) + " " + value.slice(30);
                    $("#returnTrackingLabel").css("color", "var(--main-green)");
                    returnTracking = bar;
                    returnShipper = "FedEx";
                } else {
                    $("#returnTrackingLabel").css("color", "var(--main-red)");
                    returnTracking = "null";
                }
            } else if ($("#returnTrackingInput").val() == "") {
                $("#returnTrackingLabel").css("color", "var(--slategray)");
                returnTracking = "null";
            } else {
                $("#returnTrackingLabel").css("color", "var(--main-red)");
                returnTracking = "null";
            }
            updateText();
        });

        $("#RQCheck").change(function () {
            if($("#RQCheck").is(":checked")) {
                RQCheck = true;
            } else {
                RQCheck = false;
            }
            updateText();
        });

        function updateText() {
            if (RQCheck) {
                var text = "Recieved item from Apple in RQ. <br><br>";
                text += sentShipper + " Sent Tracking: " + sentTracking + "<br>";

                if (returnTracking != "null") {
                    text += returnShipper + " Return Tracking: " + returnTracking + "<br>";
                }

                text += "RQTracking: " + sro;

                $("#outputText").html(text);
            } else {
                var text = "Submit ticket";

                $("#outputText").html(text);
            }
        }

        function clear() {
            $("#SROInput").val('');
            $("#sentTrackingInput").val('');
            $("#returnTrackingInput").val('');

            console.log("Cleared");
        }
    </script>
</html>